
name: Summarize Repository Content

on:
  workflow_dispatch: # Manual trigger
  push:
    branches: [ "main" ] # Or adjust as needed
  schedule:
    - cron: "0 4 * * 1" # Weekly summary

permissions:
  contents: write
  models: read

jobs:
  summarize:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build repository context
        run: |
          echo "# Repository Tree" > repo_context.txt
          cat *
          echo "\n# README Preview" >> repo_context.txt
          head -n 100 README.md >> repo_context.txt || echo "No README found" >> repo_context.txt
          cat repo_context.txt

      - name: Run AI inference
        id: inference
        uses: actions/ai-inference@v1
        with:
          model: gpt-4o-mini # GitHub-hosted model
          prompt: |
            You are an expert technical writer. Summarize this repository for engineers. Explain what the project does, its main components, and tech stack.
            Repository context:
            ${{ steps.build-context.outputs.repo_context }}

      - name: Save AI summary
        run: |
          echo "${{ steps.inference.outputs.response }}" > REPO_SUMMARY.md

      - name: Commit summary back to repo
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add REPO_SUMMARY.md
          git commit -m "chore: update AI-generated repository summary"
          git push
